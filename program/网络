网络
	结点:网络设备 计算机 交换机
	计算机接交换机组成网络
	网线:链路
	距离小于100m

互联网(internet)
	网络与网络通过 路由器 相连接
	多个交换机接路由器组成互联网

因特网(Internet)
	全球最大的互联网

互联网服务提供商(ISP)
	1、向公众提供网络服务:电信、移动、联通...

	2、ISP可以从互联网管理机构申请到很多IP地址,然后一些机构和个人从某个ISP获取IP地址的使用权,
	并可通过该ISP连接到互联网。

	3、三层ISP结构分为主干ISP,地区ISP,本地ISP。
	本地ISP给用户提供最直接的服务,本地ISP可以连接到地区ISP,也可以连接到主干ISP。
	从原理上讲。只要每一个本地ISP都安装了路由器连接到某个地区ISP,而每一个地区ISP也有路由器连接到主干ISP,
	那么在这些相互连接的ISP的共同作用下,就可以完成互联网中的所有的分组转发任务。

因特网组成(边缘部分 核心部分)
	主机间的通信方式(边缘部分)
		(1)客户服务器方式(C/S)
			客户端请求服务器,服务器向客户提供服务
		(2)对等方式(P2P)
			计算机既可以充当客户又可以充当服务器:客户A从服务器下载250M,客户B可以从客户A(多个客户端)中下载250M。
	数据交换方式(核心部分)
		(1)电路交换:适合数据量大的实时性传输,核心路由器之间可以使用电路交换
			需要通信时候建立连接,结束后断开。临时搭建专线
				建立连接:申请占用通信资源
				通话:占用通信资源
				释放连接:释放通信资源
		(2)报文交换:报文一般比分组长的多,交换时延长
			报文不作分组,类似分组交换
		(3)分组交换:路由器存储转发功能(优点:高效 灵活 迅速 可靠)(缺点:时延 开销)
			完整的文档称报文
			发送端
				将报文分段分组,每一段首部写信息,将分组选择路径发放出去
			接收端
				报文首部信息去掉,分组数据合并

局域网 自己购买设备 带宽固定 距离100m
广域网 花钱买服务 花钱买带宽

计算机网络的性能
	1byte(B) = 8bit(比特 位)
	速率(字节byte B)接在计算机网络上的主机在数字信道上传送数据位数的速率,也称为比特率B/s,KB/s,MB/s,GB/s,下载时候速度
	带宽(位bit):数据通信领域中,数字信道所传送的最高数据率b/s,kb/s,Mb/s,Gb/s
	吞吐量:单位时间内通过某个网络(所有信道)的数据量b/s,Mb/s
	时延
		发送时延(准备发送 到 开始发送) = 数据块长度(bit) / 信道带宽 (bit/s)
		传播时延(在链路上传播时间) = 信道长度(m) / 信号在信道上的传播速率(m/s)
		处理时延(数据在结点A中处理选择路径传送结点B) = 网络结点存储转发处理时间(数据在结点A中选择路径到结点B中)
		排队时延 = 数据在结点A中排队处理
	时延带宽积 = 传播时延 * 带宽
	往返时间(RTT):从发送方发送数据开始,到发送方收到接收方确认
	利用率
		信道利用率 = 有数据通过时间 / (有+无)数据通过时间
		网络利用率:信道利用率加权平均值
		D = D0 / (1 - U) D表示网络当前时延 D0表示表示网络空闲时的时延 U表示信道利用率

OSI七层模型
	--------------------------开发人员--------------------------
	应用层：能够产生网络流量能够和用户交互的应用程序
	表示层：加密 压缩减少传输的带宽
	会话层：服务器和客户端建立的会话(查木马 盗窃信息控制机器)netstat /?
	--------------------------网络工程师------------------------
	传输层：可靠传输(建立会话) 不可靠传输 流量控制
	网络层：IP地址选址 选择最佳路径(IP地址决定终点位置)
	数据链路层：输入如何封装 添加物理层地址MAC(MAC地址决定下一跳地址)
	------------------------------------------------------------
	物理层：电压 接口标准
	------------------------------------------------------------
四层
	应用层5-7
	运输层4
	网络层3
	网络接口层1-2

------------------------------------------------------------------------------
物理层
	解决如何在连接各种计算机的传输媒体上传输数据比特流而不是指具体的传输媒体。
	物理层的主要任务描述为：确定与传输美媒体的接口的一些特性
	机械特性：例接口形状，大小，引线数目
	电气特性：规定电压范围
	功能特性：规定5V表示1
	过程特性：规定建立连接时各个相关部件的工作步骤

	数据通信模型
		PC(传输数字比特流)-->调制解调器(转化为模拟信号)-->共用电话网-->调制解调器(转化为数字比特流)-->PC
		调制解调器：将信号进行转换，将不同介质的信号(光纤、ADSL、有线)进行转变

	通信的目的是传送消息
		1、数据：运送消息的实体
		2、信号：数据的电气或电磁的表现
		3、模拟信号：消息的参数的取值是连续的
		4、数字信号：消息的参数的取值是离散的
		5、码元：使用时间域的波形表示数字信号时，则代表不同离散数值的基本波形就成为码元
		6、在数字通信中常常用时间间隔相同的符号来表示一个二进制数，这样的时间间隔内的信号称为二进制码元。
		间隔称为码元长度。1码元可以携带nbit的信息量

	信道概念
	信道一般表示向一个方向传送数据的媒体，平常所说的通信线路往往包含一条发送信息的信道和一条接收信息的信道
		1、单向通信(单工通信)：只能有一个方向的交互
		2、双向交替通信(半双工)：通信的双方都可以发送信息，但不能双方同时发送/接收
		3、双向同时通信(全双工)：通信的双方可以同时发送和接收信息

	基带信号：来自信源的信号。像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。
	基带信号就是发出的直接表达了要传输的信息的信号，说话的声波就是基带信号
	带通信号：把基带信号经过载波调制后，把信号的频率范围搬移到较高的频段
	以便在信道中传输(即仅在一段频率范围内能够通过信道)

	调制方法
		1、调幅(AM)：载波的振幅随数字信号而变化
		2、调频(FM)：载波的频率随基带数字信号而变化
		3、调相(PM)：载波的初始相位随基带数字信号而变化

	编码(归零：无论信号是1/0完结后都归零)
		1、单极性不归零：只使用一个电压值，高电平1，没电压0
		2、双极性不归零码：用正电平和负电平分别表示二进制1和0
		3、双极性归零码：正负零三个电平，信号本身携带同步信息
		4、曼彻斯特编码：信号低--高为0，信号高--低为1。一个时钟周期只可表示1bit，必须经过两次采用得到1bit
		5、差分曼彻斯特编码：bit中间有信号跳变，bit与bit之间有信号跳变表示下一bit为0
							bit中间有信号跳变，bit与bit直接没信号跳变表示下一bit为1
	处理失真
		1、奈氏准则：理想低通信道的最高码元传输速率 = 2WBaud(W是理想低通信道的带宽HZ，Baud是波特，是码元传输速率的单位)
		2、香农公式：信道的极限信息传输速率C = Wlog2(1+S/N) b/s (W为信道的带宽 S为信道内所传信号的平均功率 N为信道内部的高斯噪声功率)

	导向传输媒体
		1、电磁波沿固体媒体传播
		2、双绞线:屏蔽双绞线STP,无屏蔽双绞线UTP
		3、同轴电缆：50Ω用于数字传输，多用于基带传输。75Ω用于模拟传输，宽带同轴电缆
		4、光纤

	非导向传输媒体
		短波通信主要靠电离层的反射，但短波信道的通信质量较差。
		微波在空间主要是直线传播：地面微波接力通信。卫星通信。

	信道复用
		1、频分复用：用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。所有用户在同样的时间占用不同的带宽(频率)资源。
		2、时分复用：将时间划分为一段段等长的时分复用帧。每一个用户在每一个帧中占固定序号的时隙，每一个用户占用的时隙周期性出现。所有用户在不同的数据占用同样的频带宽度。
		3、码分复用：将一个bit时间划分为m个短的间隔称为码片。每个站都有一个码片，用码片解密得1/-1能接收信号。其余码片解密得0。

	带宽接入信号
		1、xDSL：用数字技术对现有的模拟电话用户线进行上网。把0-4kHz，低端频谱留给传统电话使用，而把原来没有被利用的高端频谱留给用户上网使用。
		2、光纤同轴混合网：通过有线电视网基础开发的一种居民宽带入网。
		3、FTTx：光纤到户

------------------------------------------------------------------------------
数据链路层
	使用点对点信道(PPP协议(广域网))：一对一的点对点通信方式。
	使用广播信道(CSMA/CD协议(局域网))：一对多的广播通信。
	链路：一条点到点的物理线路段。
	数据链路：除物理线路外，还需有通信协议来控制这些数据的传输，把协议的硬件和软件加到链路上，就构成了数据链路
			常用的方法使用适配器(网卡)来实现这些协议的硬件和软件，一般的适配器包括数据链路层和物理层
	帧(数据链路传输)：在前后加入数据组成帧
	不使用序号和确认机制：出现错的概率不大，就算保证了数据链路层可靠也不能保证网络层传输可靠，FCS字段可保证无差错接收
	端口与MAC地址绑定可以实现第二层网络安全，有效的规避非法用户的接入

	PPP协议：链路层协议采用点对点信道
		1、封装成帧
		2、透明传输
		3、差错控制
		4、在同一条物理链路上进行点对点的数据传输，对数据链路层的帧不进行纠错，不需要序号，不需要流量控制。
		5、多种网络层协议：在同一条物理链路上同时支持多种网络层协议(如IP和IPX等)的运行。
		6、多种链路类型：PPP必须能够在多种类型的链路上运行，例如串行或并行链路，多种传输介质。
		7、检测连接状态：自动检测链路是否处于正常工作状态。
		8、IP分配，用户验证

	数据链路层的三个基本问题
		1、封装成帧：在一段数据的前后分别添加首部和尾部，构成一个帧
					帧首部(SOH) + 帧的数据部分(IP数据报 MTU(最大传输单元)(最大不超过1500byte))+ 帧尾部(EOT)
					帧没发送完，判别是否发送完整
		2、透明传输：若传输的数据是ASCII码中有头尾标志时会判别为完整的帧，但实际未完整
					用字节填充解决问题，在冲突的数据前加上转义字符
						信息字段出现7E转变成0x7D，0x5E，出现0x7D转变为0x7D，0x5D
						出现ASCII码的控制字符(数值小于0x20)前面加入0x7D，同时将该字符的编码加以改变
					使用SONET/SDH链路时，使用同步传输(用比特流)时候采用零比特填充，5个1后面填充0
		3、差错控制：传输过程中可能产生比特差错1-->0 0-->1，在一段时间内，传输错误的bit所占传输bit总数的比率称为误码率BER。作除法(异或)运算
					CRC循环冗余检验：在发送端，先把数据分为组，假定每组K个bit。假设待传送的一组数据M = 101001(K = 6)。在M后面添加供差错检测用的n位冗余码一起发送
					被除数M K位 除数P 在M后添加n个0 P比n多一位，得(K+n)位的数除以事先选定好的长度(n+1)的除数P
					得出商Q而余数是R，余 数R比除数P少一位，即R是n位 R作为FCS，在M后面添加R。接收方得数据M除P得余数0传输无错误
					帧检测序列FCS：CRC得到FCS一种方法，CRC只是检测错不纠错，错误就丢弃

	PPP协议组成
		1、高级数据链路控制协议(HDLC)可以用于异步串行或同步串行介质
		2、链路控制协议(LCP)使用LCP(链路控制协议)建立并维护数据链路连接，负责身份验证，通过后NCP可以用了
		3、网络控制协议(NCP)允许在点到点连接上使用多种网络层协议

	PPP协议的帧(F + A + C + 协议 + IP数据报 + FCS + F)(IP数据报为网络层传输的数据，前面为帧头，后面为帧尾)
		Byte------1-----------1-----------1-----------------------不超过1500byte---------2----------1------
			|	F(7E)	|	A(FF)	|	C(03)	|	协议	|	信息部分(IP数据报)	|	FCS   |   F(7E)   |
			-----帧-----------------------------------头--------------------------------帧---------尾------
		协议(不同数据代表信息部分不同含义)
		1、0x0021--信息部分是IP数据报
		2、0xC021--PPP链路控制数据
		3、0x8021--网络控制数据
		4、0xC023--安全性认证PAP
		5、0xC025--LQR
		6、0xC223--安全性认证CHAP

	以太网(局域网LAN)CSMA/CD协议(载波监听多点接入/碰撞检测)：链路层协议采用广播信道
		1、多点接入：计算机以多点接入的方式连接在一根总线上
		2、载波监听：每一个站在发送数据之前先检测一下总线上是否有其他计算机在发送数据，若有暂时不发送，以免发送碰撞
		3、碰撞检测
			争用期：发送数据帧最多经过2τ，通常去51.2微秒为争用期长度，对于10Mb/s以太网，在争用期内可发送512bit，即64字节
			最短有效帧长：发生冲突，一定在发送的前64字节内，一检测冲突就立即中止发送，规定最短有效帧长为64字节，长度小于64字节的帧是冲突而异常中止的无效帧
		4、碰撞处理：发生碰撞后，推迟一个随机时间在发送数据
			确定基本退避时间，一般取2τ
			定义参数K = Min[重传次数，10]
			从整数集合[0,1,....,(2^K)-1]随机取出一个数，记为r。重传所需的时延就是r倍的基本退避时间
			重传16次仍不成功即丢弃帧，并向高层报告

	信道利用率
		帧长L(bit)数据发送速率C(b/s)，帧发送时间L/C = T0(s)
		a = τ/T0 a越接近0，利用率越高

	MAC层的硬件地址(MAC地址/局域网地址)：它是一个用来确认网络设备位置的位址。MAC地址用于在网络中唯一标示一个网卡
		MAC地址是出厂时候确定的唯一的，但是可以传输时候计算机用指定的MAC地址(同一局域网内有相同MAC地址会冲突)
		MAC帧（最小64字节）
		Byte--------6-------------6-----------2--------46-1500-------4-----
			|	目的地址	|	源地址 	 |  类 型	|	数 据	|	FCS   |
			---------------------------------------------------------------
			发送广播的时候目的mac地址为全ffff-ffff-ffff

        以太网帧完整长度
        前导码 7Byte(前导字符)+1Bytes(帧开始界定符) 发收方同步时钟和bit流
        帧间隙 12Bytes(最小) 等待12Bytes时间在发送
        前导码+帧间隙+MAC帧

        pps(包转发率)
            64字节包
                千兆口:1000Mbps/((64+20)*8) = 1.488Mpps = 1488000pps


	网桥扩展以太网

	交换机
		交换机工作于OSI参考模型的第二层，交换机内部的CPU会在每个端口成功连接时，通过将MAC地址和端口对应，形成一张MAC表。
		在今后的通讯中，发往该MAC地址的数据包将仅送往其对应的端口，而不是所有的端口。
		生成树算法防止形成环，广播时候不会不停转发


	VLAN（虚拟局域网）
		交换机划分VLAN：虽然在同一交换机上，但划分不同广播域，不同广播域之间资源不能互相访问是互相隔离的
		路由器划分VLAN：在同一路由器物理端口上能够连接2个或以上的网段
		三层交换机的内网限制功能更加强大，路由器上划分VLAN更方便。如果不同网段之间的数据交换比较多，需要用三层交换机划分；否则的话，直接用路由器划分VLAN就可以满足。
			三层交换机就是具有部分路由器功能的交换机，工作在OSI参考模型的第三层。三层交换机的最重要目的是加快大型局域网内部的数据交换，所具有的路由功能也是为这目的服务的，能够做到一次路由，多次转发。
		同一个交换机上都是一个VLAN不需要配置干道链路
		跨交换机VLAN：VLAN1分别在两个交换机上如何通信。
			交换机两个端口
				访问端口：只能承载某一个VLAN的流量
				中继端口：同时承载多个VLAN的流量，数据进入中继端口添加标记，离开端口去掉标记
			将交换机中继端口配置成干道链路，可以节省网线
				交换机3 VLAN1（3）和VLAN2（3）
				交换机2 VLAN1（2）和VLAN2（2）
				VLAN1（3）传输数据给VLAN1（2），交换机3通过干道链路传输给交换机2

------------------------------------------------------------------------------
网络层
	虚电路服务：分组都沿着逻辑连接（同一条虚电路）传送，虚电路断了，其余分组传输不了
	数据报服务：分组写好地址，路径由路由器选择。不提供纠错，分组可能丢失，出错，重复

	中间设备
		物理层：转发器（信号放大）
		数据链路层：网桥或桥接器或交换机
		网络层：路由器
		网络层以上：网关
		现在所说的网关是路由器接口的地址

	IP协议
		IP协议(路由协议)
		地址解析协议ARP
		逆地址解析协议RARP
		网际控制报文协议ICMP
		网际组管理协议IGMP
		4个协议关系
		-------------------------
		|			ICMP IGMP	|
		|		IPV4			|
		|	ARP					|
		-------------------------

	网络地址
		主机全0和全1的都保留不用(最大主机数-2)
													网络起始		子网掩码		最大网络数	最大主机数	不外派
		A类：8位网络地址 24位主机ID		最高位0  	1-126			255.0.0.0 		2^7-2		2^24-2		0和127(最大网络数-2)可用：1.0.0.1~126.255.255.254
		B类：16位网络地址 16位主机ID	最高位10	128-191	 		255.255.0.0		2^14-1		2^16-2		128.0.0.0(最大网络数-1)可用：128.0.0.1~191.255.255.254
		C类：24位网络地址 8位主机ID		最高位110	192-223 		255.255.255.0	2^21-1		2^8-2		192.0.0.0(最大网络数-1)可用：192.0.0.1-223.255.255.254
		D类：多播/组播地址				最高位1110  224-239
		E类：研究
		特殊地址
			127.x.x.x	本地环回地址，一般用于测试使用。例如：ping 127.0.0.1 来测试本机TCP/IP是否正常。
			169.254.x.x 微软用户获取不到IP时自动分配的IP地址
			保留地址(作为局域网使用)
			A类地址：10.0.0.0～10.255.255.255
			B类地址：172.16.0.0 ～172.31.255.255
			C类地址：192.168.0.0～192.168.255.255

	子网掩码
		网络地址与子网掩码作与运行，相同在同一个网段，不同网段在路由器中转发数据报
		IP地址 & 子网掩码 = 子网地址
		子网地址 | ~(子网掩码) = 广播地址

	子网划分
		等分子网
			划分两个子网-->主机少一位-->网络多一位-->0位A子网 1为B子网(等分2个子网) 255.255.255.128
				A子网的网络地址：192.168.0.0/25，可用地址（192.168.0.1~192.168.0.126），广播地址：192.168.0.127。
				B子网的网络地址：192.168.0.128/25，可用地址（192.168.0.129~192.168.0.254），广播地址：192.168.0.255。
			划分四个子网-->主机少两位-->网络多两位-->00A网 01B网 10C网 11D网 2^2 = 4 255.255.255.192
				A子网：192.168.0.0/26，可用(192.168.0.1~192.168.0.62)，广播192.168.0.63
				B子网：192.168.0.64/26，可用(192.168.0.65~192.168.0.126)，广播192.168.0.127
				C子网：192.168.0.128/26，可用(192.168.0.129~192.168.0.190)，广播192.168.0.191
				D子网：192.168.0.192/26，可用(192.168.0.193~192.168.0.254)，广播192.168.0.255
				主机位数6位 2^6 = 64  192.168.0.0 ~ 192.168.0.64 ~ 192.168.0.128 ~ 192.168.0.192 ~ 192.168.0.255
				最大主机位数2^6-2 = 62

		变长子网划分
			30台为A网 	(2^n)-2 >= 30 n=5(主机位数最少)
						8-5 = 3(网络号最多借用位数)
						掩码：255.255.255.224(111(借用3位网络号)0 0000(剩余主机位数))
						192.168.0.0/27~192.168.0.32/27 可用(192.168.0.1 ~ 192.168.0.30)
						例：IP：192.168.0.80 子网地址：192.168.0.64/27~192.168.0.96/27  64+2^5(主机最少位数) = 96 可用(192.168.0.65 ~ 192.168.0.94)

			10台为B网	(2^n)-2 >= 10 n = 4
						8-4 = 4
						掩码：255.255.255.240
						192.168.0.96/28 ~ 192.168.0.112/28 96+2^4 = 112 可用(192.168.97 ~ 192.168.0.110)

			IP地址172.16.66.10 255.255.192.0(/18) 的子网地址和广播地址？ 18-16 = 2   2^6 = 64
			子网	172.16.64.0~172.16.128.0 可用(172.16.64.1 ~ 172.16.127.254) 广播172.16.127.255
			IP地址172.16.50.10 255.255.224.0(/19) 的子网地址和广播地址？ 19-16 = 3	 2^5 = 32
			子网	172.16.32.0~172.16.64.0 可用(172.16.32.1 ~ 172.16.63.254)

		超网合并
			子网掩码往左移1位，能够合并2个连续的网段(小网段为偶数，大网段为奇数(保证第0位为0 和 1)。相反要进位，跨网段合并)，但不是任何连续的网段都能合并
			192.168.0.0 192.168.1.0 合并后255.255.254.0    0-->0000 0000 1-->0000 0001 网络左移1位屏蔽不同部分
			192.168.2.0 192.168.3.0 合并后255.255.252.0	   2-->0000 0010 3-->0000 0011 网络左移1位屏蔽不同部分
			192.168.1.0 192.168.2.0 不能合并，合并后192.168.0.0 192.168.3.0都在同一个网段不符合，要是将4网段个合并可以左移2位
			判断连续2个网段是否能够合并，只要第一个网络号能被2整除，就能够通过左移1位子网掩码合并。2^n = 2(左移n为子网掩码合并)
			判断连续4个网段是否能够合并，只要第一个网络号能被4整除，就能够通过左移2位子网掩码合并。2^n = 4(左移n为子网掩码合并)
			判断连续8个网段是否能够合并，只要第一个网络号能被8整除，就能够通过左移3位子网掩码合并。2^n = 8(左移n为子网掩码合并)

	交换机基于数据帧的MAC地址转发数据帧，路由器基于数据包IP地址转发数据包
	数据包传输过程不变，网络设备数据帧要用新的物理层地址重新封装
	MAC地址决定数据帧下一跳哪个设备接收，而IP地址决定了数据包的起点与终点

	ARP&RARP
		IP--->ARP--->物理地址
		物理地址--->RARP--->IP

		IP数据报需从主机A上传送到主机B上，主机A首先查找路由表;
		if(目的主机是与自己在同一个网段内)
		{
			主机A查询自己的ARP表;
			if(有该目的IP地址对应的MAC地址的记录)
			{
				将该MAC地址作为目的MAC地址，封装数据帧，传送给主机B;
			}
			else
			{
				发送一个ARP请求广播给网段内的所有主机，来查询该目的IP地址的MAC地址;
				发送端IP地址和发送端MAC地址为主机A的IP地址和MAC地址，目标IP地址和目标MAC地址为主机B的IP地址和全0的MAC地址。
				收到ARP请求报文的各个主机，如果发现该IP地址是自己的IP地址时，将ARP请求报文中的发送端（即主机A）的IP地址和MAC地址存入自己的ARP表中。之后以单播方式发送ARP响应报文给主机A，其中包含了自己的MAC地址。
				如果发现不是自己的IP地址，则丢弃该报文。
				主机A收到这个应答报文后，就按照返回的MAC地址，将IP数据包封装成帧，然后发送到主机B上;
				（补充：一般为了减少网络中的报文量，通信双方会维护一个各自的ARP表，把一次通信中获得IP MAC地址对保存在缓冲的ARP表中,但是ARP表有一个老化机制，删除一段时间内不用的IP MAC地址对。）
			}
		}
		else
		{
			发ARP包请求得到下一跳的MAC地址
			把报文发给该表目指定的下一站的路由器或直接连接的网络接口;//源MAC地址改为当前MAC 目的MAC地址改为为下一跳MAC
			//ARP请求报文只负责IP数据报传输过程中每一跳中的目的MAC地址查询。
		}

	RARP
		发送主机发送一个本地的RARP广播，在此广播包中，声明自己的MAC地址并且请求任何收到此请求的RARP服务器分配一个IP地址；
		本地网段上的RARP服务器收到此请求后，检查其RARP列表，查找该MAC地址对应的IP地址；
		如果存在，RARP服务器就给源主机发送一个响应数据包并将此IP地址提供给对方主机使用；
		如果不存在，RARP服务器对此不做任何的响应；
		源主机收到从RARP服务器的响应信息，就利用得到的IP地址进行通讯；如果一直没有收到RARP服务器的响应信息，表示初始化失败。

	IP数据报(首部+数据部分(含ICMP报文))
		首部
			Bit	0------4--------8------------------16---19--------------24---------31
				| 版本 |首部长度|     服务类型   	|			  总长度			|
			固	|-------------------------------------------------------------------|
				|				标识			    |标志|		  片位移			|
			定	|-------------------------------------------------------------------|
				|	 生存时间   |		协议		|			首部校验和			|
			部	|-------------------------------------------------------------------|
				|							 源地址									|
			分	|-------------------------------------------------------------------|
				|							目的地址								|
				|-------------------------------------------------------------------|
			可变|						可选字段(长度可变)				|	填充	|
				---------------------------------------------------------------------
			版本：4位；IP协议的版本号目前为4(IPV4)。
			首部长度：4位来表示最大数值是15个单位(一个单位4字节)IP的首部长度最大值60字节。
			服务类型：8位；用来更好获得服务又叫QoS，一直未必使用，需要和路由器设置匹配才有效。
			总长度：16位；首部和数据之和长度，最大为65535，总长度不超过最大传输单元MTU。
			标识：16位；计数器，产生数据报的标识，不是序号，每产生一个数据报，增加1。
			标志：3位；目前只有前两位有意义，最低位MF。MF = 1表示后面"还有分片(一个MTU分开好多小片段都加上首部传输)"。MF = 0表示最后一个分片，中间一位DF，DF = 0才允许有分片。
			片偏移：13位；较长的的分组在分片后，某片在原分组中的相对位置，片偏移以8字节为偏移单位，片偏移 = 起始字节/8。
			生存时间：8位；记为TTLs数据报在网络中可通过的路由器的最大值，每经过一个路由器-1，到0路由器丢弃。
			协议：8位；指出数据报携带的数据使用何种协议，以便目的主机的IP将数据报上交给哪个处理过程。
			首部校验和：16位；验证数据报的首部，
				发送端 字1 字2 检验和置0 ... 字n-->反码算术运算求和-->取反码作为校验和
				接收端 字1 字2 校验和 ... 字n -->反码算术运算求和-->取反码作为结果
				结果 = 0则保留，否则丢弃
			可选字段：1~40字节用来支持排错测量以及安全等措施。

	数据路由
		数据包必须能去能回网络才通，沿途路由器必须知道到目标网络下一跳的哪个接口

	ICMP
		主机或路由器报告差错情况和提供有关异常情况的报告
		报文
			Bit	0-----------8----------16----------31
				|	类型	|	代码	|	校验和	|
				-------------------------------------
				|		取决于ICMP报文类型			|
				-------------------------------------
				|		数据部分(长度取决于类型)	|
				-------------------------------------
			类型两种：差错报告报文和询问报文
			差错报告五种：终点不可达、源点抑制、时间超时、参数问题和改变路由(重定向)
			询问报文两种：回送请求和回答报文，时间戳请求和回答报文
		A--ping->B
		收到的IP数据报(B)：IP数据报首部+8字节+IP数据报数据字段(ping信息)
		ICMP差错报文： ICMP8字节+IP数据报首部+8字节(8字节为信息)(去掉IP数据报数据字段)
		返回给A：IP数据报首部+ICMP差错报文

	IGMP
		组播(多播)协议

	动态路由协议
		RIP (自治系统)
			周期性广播更新路由表(30s) 根据跳数选择最佳路径(不考虑带宽，可能选择带宽低路径) 最大跳数16
		OSPF(自治系统)
			根据带宽选择最佳路径 支持多区域 触发式更新(添加删除才更新) 三个表(邻居表 hello包(维持邻居表) 链路状态表)
		BGP	(不同自治系统)
			连接各个自治系统

	VPN
		VPN定义了两个内部网络的路由器之间通过Internet建立的通信隧道，使用IP-in-IP封装后在隧道中转发数据报
		为了保证保密性，隧道发送路由器把内网IP数据报加密后，封装为外网IP数据报的数据部分在外网中进行传输(内网IP数据报再封装成外网IP数据报(重新添加源IP地址和目的地址))
		隧道接收路由器收到数据报后，从外网数据报中取出数据部分，将数据报解密，还原成内网数据报，然后转发该数据报


	网络地址转换
		内网地址---->NAT路由器---->外网(源IP地址 改为 NAT路由器IP地址，源端口改为NAT路由器生成端口)
		外网---->NAT路由器---->内网地址(目的IP地址 改为 NAT路由器IP地址，目标端口为NAT路由器端口，由路由器根据端口查询主机请求)

		NAT路由器转发出去的数据包的源端口是路由器生成的NAT端口，并不是内部主机发过来的内部端口(因为两台主机的端口可能一样)
		如果再有两台内部主机同时访问相同网站，NAT根据响应包的目的端口(注意这里是NAT端口)，并查询地址转换表，即可将响应组装成内部IP数据报，并转发到正确的主机。

		端口映射(外网可以访问内网)

	VPN是将内部IP数据报加密后打包成外部IP数据报的数据部分，它的主要目的是为了数据的保密性，
	NAT是纯进行地址转换，它的目的是为了解决本地编址的内部网络与外网通信的问题。

------------------------------------------------------------------------------
传输层
	TCP 分段 编号 流量控制 建立会话
		如何实现可靠传输
			发送方要收到接收方应答才继续发下一个包
			发送方连续发送多个分组，不必每发完一个等待确认，提高信道利用率：流水线传输
			连续ARQ协议
				发送方维持发送窗口(如发送窗口为5)
				1 2 3 4 5 6 7 8 9 10 11 12
			发送方：连续发送5个包，等到数据包1应答后，变为23456，开始发送数据包6，始终维持发送窗口5
			接收方：采用累积确认，一次收到几个包才回发应答，如收到123数据包，发数据包3应答，发送方收到后代表123数据包发送成功，发送45678
					若收到124数据包，发送数据包2应答，发送方收到后代表1 2数据包发送成功，发送34567

		报文首部格式(20字节固定头部 TCP首部+TCP数据部分)
			Bit 0--------3-------7-----16-------24-------------31
				|		 源端口			|		目的端口		|
				|-----------------------------------------------|
				|				 	   序号						|
				|-----------------------------------------------|
				|				 	  确认号					|
				|-----------------------------------------------|
				|数据偏移| 保 留 |控制位|	  	  窗口			|
				|-----------------------------------------------|
				|		 校验和			|		紧急指针		|
				|-----------------------------------------------|
				|		 选项(长度可变)			|	   填充		|
				-------------------------------------------------
			源端口：16位，最大65535。
			目滴端口：16位，最大65535。
			序号：32位，序号为TCP数据部分起始占整个文件的多少个字节。
			确认号：32位，确认后号为最后一个字节+1，是指下一次应该收到的数据的序列号。
			数据偏移：4位，该字段表示TCP所传输的数据部分应该从TCP包的哪个位开始，当然也可以把它看做TCP首部的长度。0001(化为10进制)*4字节。
			保留：4位
			控制位：8位
				CWR(Congestion Window Reduced)：CWR标志与后面的ECE标志用于IP首部的ECN字段。ECE标志为1时，则通知对方将拥塞窗口变小。
				ECE(ECN-Echo):ECE标志表示ECN-Echo。置为1会通知通信对方，从对方到这边的网络有拥塞。在收到数据包的IP首部中ECN为1时将TCP首部中的ECE设置为1。
				URG(Urgent Flag):该为为1时，表示包中有需要紧急处理的数据。对于需要紧急处理的数据，会在后面的紧急指针中再进行解释。
				ACK(Acknowledge Flag):该位为1时，确认应答的字段变为有效。TCP规则除了最初建立时的SYN包之外该为必须设置为1。
				PSH(Push Flag):该位为1时，表示需要将受到的数据立即传输给上层的应用。PSH为0时，则不需要立即上层而是先进行缓存。
				RST(Reset Flag):该位为1时表示TCP连接中出现异常必须强制断开连接。例如，一个没有被使用的端口即使发来连接请求，也无法通行。
								此时就可以返回一个RST设置为1的包。此外，程序宕掉或切断电源等原因导致主机重启的情况下，由于所有的连接信息将全部被初始化，
								所以原有的TCP通行也将不能继续进行。这种情况下，如果通信对方发送一个设置为1的RST包，就会使用心强制断开连接。
				SYN(Synchronize Flag):用于建立连接。SYN为1表示希望建立连接，并在其序列号的字段进行序列号初始值的设定。
				FIN(Finish Flag):该位为1时，表示今后不会再有数据发送，希望断开连接。当通信结束希望断开连接时，通信双方的主机之间就可以相互交换FIN位置为1的TCP段。
								每个主机又对对方的FIN包进行确认应答以后就可以断开连接。不过，主机收到FIN设置为1的TCP端以后不必马上回复一个FIN包，
								而是可以等到缓冲区中所有数据都已成功发送而被自动删除之后再发。
			窗口：16位，指TCP发送，接收的缓存数据最大
			校验和：16位，
			紧急指针：16位，当URG标志位为1时才代表，紧急数据的长度
			选项：40字节，1111(15数据偏移最大数据)*4字节 - 20(头部固定) = 40字节(最大)。

		流量控制
			发送确认包时，发送当前窗口可以接收数据长度，实时更改窗口大小。窗口大小根据接收方窗口和拥塞窗口最小那个决定

		拥塞控制
			慢开始+拥塞避免
				设置拥塞窗口值，数据包一次发送窗口值，若往返快，则指数增长窗口值，达到设置的阈值，用加法增加窗口值。
				发送丢包，重新计算阈值，窗口值清0重新发送，未达到阈值时，继续指数增长
			快重传
				收到124数据包时及时连续发送缺3应答包，
			快重传+拥塞避免
				设置拥塞窗口值，数据包一次发送窗口值，若往返快，则指数增长窗口值，达到设置的阈值，用加法增加窗口值。
				当发送方连续收到三个重复的确认包时转入拥塞避免
				拥塞窗口值不清0，直接将阈值给窗口值，开始加法增加窗口值

		三次握手连接
			A										B
				SYN = 1, ACK = 0, seq = x(序号)
			 -------------------------------------->(1)
			  SYN = 1, ACK = 1, seq = y, ack = x+1(确认号)
			 <--------------------------------------(2)
				  ACK = 1, seq = x+1, ack = y+1
			 -------------------------------------->(3)

			状态变化
			A：CLOSED--(1)-->SYN-SENT--收到(2)-->ESTAB-LISHED--(3)-->
			B：CLOSED-->LISTEN--收到(1)-->SYN-RCVD--(2)--> --收到(3)-->ESTAB-LISHED
			假如没有三次握手少第三次
				A发送给B，假如A选择路由比较拥塞/远(包1)，未等到B应答，再次发送请求连接(包2)。
				B收到包2发送应答并建立连接，过了一会，包1到达B建立连接，但是A已经与B建立连接，忽略包1应答的建立连接。
				B给A发送包1应答包后，B等待用包1与A建立的数据连接，但A忽略包1应答连接，造成B一直等待资源浪费。

		连接释放
			A										B
					 FIN = 1, seq = u(序号)
			 -------------------------------------->(1)
				ACK = 1, seq = v, ack = u+1(确认号)
			 <--------------------------------------(2)
				FIN = 1, ACK = 1, seq = w, ack = u+1
			 <--------------------------------------(3)
				ACK = 1, seq = u+1, ack = w+1
			 -------------------------------------->(4)
			状态变化
			A：ESTAB-LISHED--(1)-->FIN-WAIT-1--收到(2)-->FIN-WAIT-2--收到(3)-->TIME-WAIT--(4)--等待2MSL-->CLOSED
			B：ESTAB-LISHED--收到(1)-->CLOSE-WAIT--(2)--> --(3)-->LAST-ACK--收到(4)-->CLOSED

		特点：
			面向连接的传输层协议
			每一条TCP连接只能有两个端点，每一条TCP连接只能是点对点的
			提供可靠交付的服务
			提供全双工通信
			面向字节流

		TCP连接的端点不是主机，不是主机的IP地址，不是应用进程，不是传输层的协议端口，是套接字
		端口号拼接到IP地址构成套接字

	UDP 一个数据包能完成数据通信 不建立会话 多播
		首部
			Byte0-----2-------------2-------------2-----------2------
				|	源端口	|	目的端口	|	 长度	|	校验和	|
				-----------------------------------------------------
		特点：
			无连接，发送数据之前不需要建立连接
			尽最大努交付，不保证可靠交付，同时也不使用拥塞控制
			面向报文，UDP没有拥塞控制，很适合多媒体通信要求
			支持一对一，一对多，多对一的交互通信
			首部开销小，共8字节


	用端口定位服务(http/FTP.....)，用IP地址定位服务器
	传输层与应用层之间关系
		应用层协议 = 协议 + 端口
		http = TCP + 80
		https = TCP + 443
		FTP = TCP + 21
		SMTP = TCP +25
		POP3 = TCP + 110
		RDP = TCP + 3389
		共享文件夹 = TCP + 445
		SQL = TCP + 1433
		DNS = UDP + 53 OR TCP + 53
		每种网络的服务功能都不相同，因此有必要将不同的封包送给不同的服务来处理
		当你的主机同时开启了多个服务时，别人送来的数据包，就会依照数据包的 port 号码来给特定服务来处理。

------------------------------------------------------------------------------
应用层
	http https ftp DNS SMTP POP3 RDP

	域名
		根 .
		顶级域名 com edu net cn org gov(服务器性质)
		二级域名 91xueit inhe
		三级域名 dba
		www.dba.91xueit.com.

	DNS服务
		谷歌DNS 8.8.8.8
		电信DNS服务器 222.222.222.222
		将域名解析成IP地址

		域名解析过程
			根管理各个顶级域名地址，顶级域名管理对应IP地址如com 管理 www.xxx.com的IP地址
			如访问 WWW.ABC.NET，访问com域名，不在com中，访问根域名服务器，得到net地址，com服务器访问net查询IP地址并返回用户

	DHCP
		动态分配IP地址
		DHCP地址必须是静态

		请求IP地址过程
			客户端广播，DHCP服务器从IP地址中选一个给客户端

	FTP
		控制连接
			传输操控命令 21端口 发送FTP命令信息
		数据连接
			主动模式
				FTP客户端告诉FTP服务器使用什么端口侦听
				FTP服务器和客户端的这个端口建立连接 FTP源端口20
			被动模式
				FTP服务器打开端口等待客户端连接
		传输模式
			文本：ASCII模式，以文本序列传输数据
			二进制：Binary模式，以二进制序列传输数据2

	HTTP
		URL <协议>://<主机>:<端口>/<路径>

	Web代理服务器
		节省内网访问Internet的带宽
		通过Web代理绕过防火墙，如路由器防火墙(非内网目的IP丢弃)

------------------------------------------------------------------------------
网络安全
	截获：从网络数窃听他人通信内容
	中断：有意中断他人在网络上的通信
	篡改：故意篡改网络上传送的报文
	伪造：伪造信息在网络上传送

	加密技术
		对称加密：双方密钥相同
		非对称加密：双方密钥不同，公钥加密只有私钥解
		数字签名
		证书颁发机构：为企业和用户颁发数字证书，确认企业和个人身份

	安全套接字SSL(应用层)
		https用了安全套接字
		传输层<--SSL(加密)--应用层

	IPSec(网络层)
		AH：鉴别源点和数据完整性，不能保密
			IP首部+AH首部+TCP/UDO报文段
		ESP：鉴别源点，检查数据完整性和提供保密
			IP首部+ESP首部+TCP/UDO报文段+ESP尾部+ESP鉴别

	数据链路层安全
		PPP
		ADSL